# Internationalization (i18n)

All user-facing strings MUST be translated in all 4 languages: `en`, `zh`, `my`, `th`.

## MANDATORY: No Hardcoded Display Text

**CRITICAL GUARDRAIL: Every piece of text displayed to users MUST use the translation system.**

This includes:

- Button labels, form labels, placeholders
- Error messages, success messages, toasts
- Page titles, section headers, descriptions
- Empty states, loading states
- Tooltips, hints, helper text
- Dialog titles, confirmation messages
- Table headers, column names
- Badge labels, status text

### Correct Usage

```typescript
import { useTranslations } from 'next-intl';

function MyComponent() {
  const t = useTranslations('common');

  return (
    <div>
      <h1>{t('pageTitle')}</h1>
      <Button>{t('save')}</Button>
      <p className="text-muted-foreground">{t('description')}</p>
      {items.length === 0 && <p>{t('noItemsFound')}</p>}
    </div>
  );
}
```

### Wrong Usage

```typescript
// ❌ BAD - Hardcoded strings
function MyComponent() {
  return (
    <div>
      <h1>Menu Management</h1>           {/* ❌ Hardcoded */}
      <Button>Save Changes</Button>       {/* ❌ Hardcoded */}
      <p>Enter your details below</p>     {/* ❌ Hardcoded */}
      {error && <p>Something went wrong</p>}  {/* ❌ Hardcoded */}
    </div>
  );
}
```

**Exceptions (technical strings that should NOT be translated):**

- Code identifiers, variable names
- API endpoints, URLs
- Console logs (developer-only)
- Data values from the database (e.g., user-created content)

## Locale Routing Strategy

**CRITICAL: RMS uses COOKIE-BASED locale routing, NOT URL-based.**

**Configuration** (`src/middleware.ts`):

```typescript
export default createMiddleware({
  locales: ['en', 'zh', 'my', 'th'],
  defaultLocale: 'en',
  localePrefix: 'never', // ← No locale in URLs!
  localeDetection: true,
});
```

**What This Means:**

- URLs: `/hub/menu`, `/store/create` (NO `/en/hub/menu`)
- Locale stored in `NEXT_LOCALE` cookie (1-year expiry)
- Middleware detects locale from cookie → applies transparently
- Users see clean URLs without language prefix

## Navigation Patterns

### Correct - No Locale in Routes

```typescript
// Links (middleware handles locale automatically)
<Link href="/hub/menu">Menu</Link>
<Link href="/store/create">Create Store</Link>
<Link href="/">Home</Link>

// Router navigation (no locale prefix needed)
router.push('/hub/menu');
router.replace('/store/create');
router.back();

// Button with Link
<Button asChild>
  <Link href="/store/create">Create Store</Link>
</Button>
```

### Wrong - Don't Include Locale

```typescript
// ❌ Don't do this in RMS!
<Link href={`/${locale}/hub/menu`}>Menu</Link>
router.push(`/${locale}/store/create`);

// This breaks the cookie-based routing strategy
```

**Why No Locale in Routes:**

- Middleware automatically rewrites routes based on cookie
- Cleaner URLs for users
- Locale persists across navigation via cookie
- No need to pass locale through components

## Using Translations

```typescript
import { useTranslations, useLocale } from 'next-intl';

function MyComponent() {
  // Get translation function (scoped to namespace)
  const t = useTranslations('common');

  // Get current locale if needed (usually not required)
  const locale = useLocale();  // Returns: 'en' | 'zh' | 'my' | 'th'

  return (
    <div>
      <h1>{t('welcome')}</h1>
      <Button>{t('save')}</Button>
      <p>Current language: {locale}</p>
    </div>
  );
}
```

**When to Use `useLocale()`:**

- Displaying current language in UI (LanguageSwitcher)
- Formatting dates/numbers based on locale
- Conditional logic based on language
- **NOT for navigation** (middleware handles it)

## Translation Files Structure

**Location:** `messages/[locale]/[feature].json` (split by feature domain)

```
messages/
├── en/                    # English
│   ├── common.json        # common, home, errors
│   ├── auth.json          # auth
│   ├── menu.json          # menu
│   ├── navigation.json    # pages, sidebar
│   ├── tables.json        # tables
│   ├── store.json         # store
│   ├── kitchen.json       # kitchen
│   ├── orders.json        # orders
│   ├── payments.json      # payments
│   ├── reports.json       # reports
│   ├── personnel.json     # personnel
│   ├── auditLogs.json     # auditLogs
│   ├── landing.json       # landing
│   ├── tierUsage.json     # tierUsage
│   └── admin.json         # admin
├── zh/                    # Chinese (中文)
├── my/                    # Myanmar (မြန်မာ)
└── th/                    # Thai (ไทย)
```

**File Contents Example** (`messages/en/store.json`):

```json
{
  "store": {
    "choose": {
      "title": "Choose Your Store",
      "createNewStore": "Create New Store"
    }
  }
}
```

**How Files Are Loaded** (`src/i18n/request.ts`):

All 15 feature files are loaded in parallel using `Promise.all()` and merged into a single messages object at runtime.

**Translation Namespace Pattern:**

```typescript
// Scoped to namespace
const t = useTranslations('store.choose');
t('title'); // Looks for: store.choose.title
t('createNewStore'); // Looks for: store.choose.createNewStore

// Root namespace
const t = useTranslations('common');
t('save'); // Looks for: common.save
```

## Adding New Translations

**Always update all 4 locale directories:**

1. `messages/en/` - English
2. `messages/zh/` - Simplified Chinese (中文)
3. `messages/my/` - Myanmar (မြန်မာ)
4. `messages/th/` - Thai (ไทย)

**Step-by-Step:**

1. **Identify the feature domain** - Find the appropriate file (e.g., `store.json` for store-related strings)
2. **Add to all 4 locales** - Update `en/`, `zh/`, `my/`, `th/` versions of that file

**Example** - Adding a new store translation:

```json
// messages/en/store.json
{
  "store": {
    "choose": {
      "createNewStore": "Create New Store"
    }
  }
}

// messages/zh/store.json
{
  "store": {
    "choose": {
      "createNewStore": "创建新店铺"
    }
  }
}

// messages/my/store.json
{
  "store": {
    "choose": {
      "createNewStore": "စတိုးအသစ်ဖန်တီးရန်"
    }
  }
}

// messages/th/store.json
{
  "store": {
    "choose": {
      "createNewStore": "สร้างร้านใหม่"
    }
  }
}
```

**Adding a New Feature Domain:**

If adding translations for a new feature that doesn't fit existing files:

1. Create new `[feature].json` in all 4 locale directories
2. Update `src/i18n/request.ts` to import and merge the new file

## Locale Switching

**How Users Change Language:**

```typescript
// LanguageSwitcher component sets cookie + refreshes
const handleLocaleChange = (newLocale: Locale) => {
  startTransition(() => {
    // Set cookie (1-year expiry)
    document.cookie = `NEXT_LOCALE=${newLocale}; path=/; max-age=31536000; SameSite=Lax`;

    // Refresh to apply new locale
    router.refresh();
  });
};
```

**Flow:**

1. User clicks language option (e.g., "中文")
2. Cookie set: `NEXT_LOCALE=zh`
3. Page refreshes (`router.refresh()`)
4. Middleware reads cookie → applies locale
5. Translations reload from `messages/zh/*.json` (all 15 feature files merged)
6. UI updates in Chinese

## Page Props (When You DO Need Locale)

**Rare Case - Only for Special Logic:**

If you need access to the current locale in a page component (e.g., for API calls with locale-specific data):

```typescript
// You can access params.locale (but don't use it for navigation!)
interface PageProps {
  params: Promise<{ locale: string }>;
}

export default function MyPage({ params }: PageProps) {
  const { locale } = use(params);

  // ✅ OK - Use for API calls with locale param
  const { data } = useQuery({
    queryKey: ['data', locale],
    queryFn: () => fetchLocalizedData(locale),
  });

  // ❌ WRONG - Don't use for navigation
  router.push(`/${locale}/other-page`);  // Breaks convention!

  // ✅ CORRECT - Navigate without locale
  router.push('/other-page');  // Middleware handles locale

  return <div>{data}</div>;
}
```

**Important:** Most components won't need `params.locale` at all. Use `useLocale()` hook if needed.

## Summary Checklist

- [ ] All user-facing strings added to appropriate feature file in all 4 locales
- [ ] Translation keys use dot notation (e.g., `store.choose.title`)
- [ ] New translations added to correct feature file (e.g., `store.json`, `menu.json`)
- [ ] Components use `useTranslations('namespace')` hook
- [ ] **Navigation uses routes WITHOUT locale prefix** (e.g., `/hub/menu`)
- [ ] Links use plain hrefs (e.g., `<Link href="/store/create">`)
- [ ] Router methods use plain paths (e.g., `router.push('/hub/menu')`)
- [ ] `useLocale()` hook used ONLY when locale value needed for logic
- [ ] LanguageSwitcher sets cookie + calls `router.refresh()`
- [ ] If adding new feature domain: `request.ts` updated to import new file
